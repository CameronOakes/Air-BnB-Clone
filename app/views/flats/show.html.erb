<h1><%= @flat.address %></h1>
<% if @flat.reviews.any? %>
  <p>Average Rating: <%= @flat.average_rating.round(2) %> out of 5</p>
<% else %>
  <p>No reviews yet.</p>
<% end %>

<%= cl_image_tag @flat.photo.key, width: 400, height: 300, crop: :fill if @flat.photo.key %>

<%= simple_form_for [@flat, Booking.new], url: flat_bookings_path(@flat) do |f| %>
  <%= f.input :flat_id, as: :hidden, input_html: { value: @flat.id } %>
  <%= f.input :start_date, as: :date, label: 'Start Date' %>
  <%= f.input :end_date, as: :date, label: 'End Date' %>
  <%= f.button :submit, "Book Now" %>
<% end %>


<h2>Reviews for <%= @flat.address %>:</h2>


<% @reviews.each do |review| %>
  <div class="review">
    <p><strong>Rating:</strong> <%= review.rating || "No rating provided" %> out of 5</p>
    <p><%= review.content %></p>
  </div>
<% end %>


<% if current_user && @flat.bookings.where(user: current_user).exists? %>
  <% booking = @flat.bookings.where(user: current_user).last %>
  <% unless booking.review %>
    <%= link_to "Leave a Review", new_flat_booking_review_path(@flat, booking) %>
  <% end %>
<% end %>
